<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ألعاب العائلة Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- ALL STYLES UNCHANGED -->
    <style>
        :root { --app-height: 100vh; --font-title: clamp(1.4rem, 5vw, 2.5rem); }
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background-color: #0f172a; }
        body { 
            font-family: 'Tajawal', sans-serif; 
            color: #f8fafc; 
            padding: env(safe-area-inset-top, 24px) env(safe-area-inset-right, 15px) env(safe-area-inset-bottom, 20px) env(safe-area-inset-left, 15px);
            display: flex; flex-direction: column;
        }
        #app { flex: 1; display: flex; flex-direction: column; width: 100%; max-width: 800px; margin: 0 auto; }
        .bg-slate-card { background-color: #1e293b; }
        .btn-teal { background-color: #14b8a6; }
        .btn-purple { background-color: #a855f7; }
        .hidden { display: none !important; }
        #digit-boxes { display: flex; flex-direction: row-reverse; justify-content: center; gap: 8px; }
        .digit-box { 
            width: clamp(50px, 15vw, 80px); height: clamp(50px, 15vw, 80px); 
            border: 2px solid #475569; border-radius: 12px; display: flex; 
            align-items: center; justify-content: center; font-size: 1.8rem; 
            font-weight: 900; background: #1e293b; direction: ltr;
        }
        .keypad-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; width: 100%; max-width: 450px; margin: 0 auto; direction: ltr; }
        .key-btn { height: clamp(50px, 10vh, 70px); display: flex; align-items: center; justify-content: center; background: #334155; border-radius: 12px; font-size: 1.4rem; font-weight: bold; border-bottom: 4px solid #0f172a; }
        .key-btn.disabled { opacity: 0.1; pointer-events: none; }
    </style>
</head>

<body>
<div id="app">
<header></header>
<main></main>
</div>

<script type="module">
import { gameData } from './questions.js';
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, onValue, remove, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyBGwNKIykgrmewdwUZyA93DQ-LHI3rLOyw",
    authDomain: "family-games-app.firebaseapp.com",
    databaseURL: "https://family-games-app-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "family-games-app",
    storageBucket: "family-games-app.firebasestorage.app",
    messagingSenderId: "290150126558",
    appId: "1:290150126558:web:bf5a38cc8d104462d9c34f"
};

const fbApp = initializeApp(firebaseConfig);
const db = getDatabase(fbApp);
const liveRef = ref(db, 'live_game');
const scoresRef = ref(db, 'scores');
const answersRef = ref(db, 'current_answers');

let currentQuestions = [];
let currentIndex = -1;
let lastGameConfig = {};

window.startMemory = (diff) => {
    currentIndex = -1;
    lastGameConfig = { type: 'memory', diff };

    // ✅ ONLY CHANGE: 7 rounds instead of 5
    currentQuestions = Array.from({ length: 7 }, () =>
        Math.floor(1000 + Math.random() * 9000).toString()
    );

    showHostUI();
};

window.triggerNext = () => {
    currentIndex++;
    remove(answersRef);

    if (currentIndex >= currentQuestions.length)
        return announceWinner();

    handleMemoryRound(currentQuestions[currentIndex]);
};

async function announceWinner() {
    const snap = await get(scoresRef);
    const scores = snap.val() || {};
    const sorted = Object.entries(scores).sort((a,b) => b[1]-a[1]);
    const winner = sorted[0]?.[0] || "---";

    set(liveRef, { status: 'finished', winner });
    confetti({ particleCount: 300, spread: 100 });
}
</script>
</body>
</html>