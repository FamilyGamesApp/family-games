<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #0f172a; color: #f8fafc; overflow-x: hidden; }
        .bg-slate-card { background-color: #1e293b; }
        .btn-teal { background-color: #14b8a6; }
        .btn-purple { background-color: #a855f7; }
        .winner-anim { animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body class="min-h-screen flex flex-col p-4">

    <div id="app" class="max-w-md mx-auto w-full text-center py-6">
        <h1 class="text-4xl font-bold mb-8 text-teal-400">Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h1>
        
        <div id="setup-screen" class="space-y-6">
            <button onclick="setRole('host')" class="w-full btn-teal text-white p-6 rounded-2xl text-2xl font-bold shadow-lg">Ø£Ù†Ø§ Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ (Host)</button>
            <div class="space-y-2">
                <input id="player-name-input" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ..." class="w-full p-4 rounded-xl bg-slate-800 border border-slate-600 text-center text-white">
                <button onclick="setRole('player')" class="w-full bg-slate-card text-white p-6 rounded-2xl text-2xl font-bold border border-slate-700">Ø£Ù†Ø§ Ù„Ø§Ø¹Ø¨ (Ø¬ÙˆØ§Ù„)</button>
            </div>
        </div>

        <div id="section-select" class="hidden space-y-4">
            <h2 class="text-2xl font-bold mb-6">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</h2>
            <button onclick="chooseSection('adults')" class="w-full p-6 bg-slate-700 rounded-xl text-xl font-bold">Ù‚Ø³Ù… Ø§Ù„ÙƒØ¨Ø§Ø±</button>
            <button onclick="chooseSection('children')" class="w-full p-6 bg-pink-900 rounded-xl text-xl font-bold">Ù‚Ø³Ù… Ø§Ù„Ø£Ø·ÙØ§Ù„</button>
        </div>

        <div id="type-select" class="hidden space-y-4">
            <h2 class="text-2xl font-bold mb-6">Ù†ÙˆØ¹ Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
            <button onclick="chooseType('brain')" class="w-full p-6 btn-purple rounded-xl text-xl font-bold">Ø£Ù„Ø¹Ø§Ø¨ Ø°Ù‡Ù†ÙŠØ©</button>
            <button onclick="chooseType('movement')" class="w-full p-6 btn-teal rounded-xl text-xl font-bold">Ø£Ù„Ø¹Ø§Ø¨ Ø­Ø±ÙƒÙŠØ©</button>
        </div>

        <div id="game-play" class="hidden">
            <div id="host-view" class="hidden space-y-4 text-right">
                <div id="host-display" class="bg-slate-card p-6 rounded-2xl border border-slate-700">
                    <h2 id="display-title" class="text-2xl font-bold mb-4 text-teal-300">...</h2>
                    <div id="display-content" class="text-lg space-y-2"></div>
                </div>
                
                <div id="leaderboard-ui" class="bg-slate-900 p-4 rounded-xl border border-slate-800">
                    <h3 class="text-sm font-bold text-slate-500 mb-2 border-b border-slate-800 pb-1">Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
                    <div id="leaderboard-list" class="space-y-1"></div>
                </div>

                <div class="flex flex-col gap-3">
                    <button id="action-btn" onclick="triggerNext()" class="w-full btn-purple p-4 rounded-xl font-bold">Ø§Ø¨Ø¯Ø£</button>
                    <button onclick="location.reload()" class="text-xs text-slate-600">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
                </div>
            </div>

            <div id="player-view" class="hidden space-y-4">
                <div id="player-header" class="bg-slate-800 p-4 rounded-xl border border-teal-900">
                    <h2 id="player-q-text" class="font-bold text-lg text-teal-200 italic">Ø§Ù†ØªØ¸Ø± Ø§Ù„Ù…Ø¶ÙŠÙ...</h2>
                </div>
                <div id="player-input-area" class="grid grid-cols-1 gap-4"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, remove, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyBGwNKIykgrmewdwUZyA93DQ-LHI3rLOyw",
            authDomain: "family-games-app.firebaseapp.com",
            databaseURL: "https://family-games-app-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "family-games-app",
            storageBucket: "family-games-app.firebasestorage.app",
            messagingSenderId: "290150126558",
            appId: "1:290150126558:web:bf5a38cc8d104462d9c34f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const liveRef = ref(db, 'live_game');
        const scoresRef = ref(db, 'scores');

        // --- GAME DATA ---
        const gameData = {
            adults: {
                brain: [
                    { q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„ÙƒÙˆÙƒØ¨ Ø§Ù„Ø£Ø­Ù…Ø±ØŸ", options: ["Ø§Ù„Ù…Ø±ÙŠØ®", "Ø§Ù„Ù…Ø´ØªØ±ÙŠ", "Ø²Ø­Ù„"], correct: 0 },
                    { q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø³Ø¬Ø¯Ø§Øª Ø§Ù„ØªÙ„Ø§ÙˆØ© ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù†ØŸ", options: ["12", "15", "14"], correct: 1 }
                ],
                movement: ["Ø§Ù‚ÙØ² Ø¹Ù„Ù‰ Ù‚Ø¯Ù… ÙˆØ§Ø­Ø¯Ø© 10 Ù…Ø±Ø§Øª", "Ù…Ø«Ù„ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ù„Ø§ÙƒÙ…Ø© Ù„Ù…Ø¯Ø© 20 Ø«Ø§Ù†ÙŠØ©"]
            },
            children: {
                brain: [
                    { q: "Ù…Ø§ Ù‡Ùˆ Ù„ÙˆÙ† Ø§Ù„ÙØ±Ø§ÙˆÙ„Ø©ØŸ", options: ["Ø£Ø²Ø±Ù‚", "Ø£Ø­Ù…Ø±", "Ø£ØµÙØ±"], correct: 1 },
                    { q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ø£ØµØ§Ø¨Ø¹ Ø§Ù„ÙŠØ¯ Ø§Ù„ÙˆØ§Ø­Ø¯Ø©ØŸ", options: ["4", "5", "6"], correct: 1 }
                ],
                movement: ["Ø·ÙØ± Ù…Ø«Ù„ Ø§Ù„Ø¹ØµÙÙˆØ±", "Ø§Ù…Ø´Ù Ù…Ø«Ù„ Ø§Ù„Ø¨Ø·Ø©"]
            }
        };

        let myRole = ''; let myName = ''; let currentSection = ''; let currentType = ''; let currentIndex = -1;

        // --- INITIALIZATION ---
        window.setRole = (role) => {
            myRole = role;
            if (role === 'player') {
                myName = document.getElementById('player-name-input').value.trim();
                if (!myName) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ");
            }
            document.getElementById('setup-screen').classList.add('hidden');
            if (role === 'host') {
                remove(scoresRef); // Reset scores for new game
                document.getElementById('section-select').classList.remove('hidden');
            } else {
                document.getElementById('game-play').classList.remove('hidden');
                document.getElementById('player-view').classList.remove('hidden');
                listenForGame();
            }
        };

        window.chooseSection = (s) => { currentSection = s; document.getElementById('section-select').classList.add('hidden'); document.getElementById('type-select').classList.remove('hidden'); };
        window.chooseType = (t) => { currentType = t; document.getElementById('type-select').classList.add('hidden'); document.getElementById('game-play').classList.remove('hidden'); document.getElementById('host-view').classList.remove('hidden'); listenForScores(); };

        // --- HOST LOGIC ---
        window.triggerNext = () => {
            currentIndex++;
            const dataSet = gameData[currentSection][currentType];
            if (currentIndex < dataSet.length) {
                const item = dataSet[currentIndex];
                set(liveRef, { type: currentType, content: item, index: currentIndex, status: 'playing' });
                renderHost(item);
            } else {
                announceWinner();
            }
        };

        function renderHost(item) {
            document.getElementById('display-title').innerText = (currentType === 'brain') ? item.q : "Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ø­Ø±ÙƒØ©!";
            document.getElementById('display-content').innerHTML = (currentType === 'brain') ? item.options.map(opt => `<div class='p-2 bg-slate-800 rounded'>${opt}</div>`).join('') : `<p class='text-2xl text-teal-400'>${item}</p>`;
            document.getElementById('action-btn').innerText = "Ø§Ù„ØªØ§Ù„ÙŠ";
        }

        function listenForScores() {
            onValue(scoresRef, (snap) => {
                const scores = snap.val() || {};
                const list = document.getElementById('leaderboard-list');
                list.innerHTML = Object.entries(scores).sort((a,b) => b[1]-a[1]).map(([name, val]) => `<div class="flex justify-between"><span>${name}</span><span class="text-teal-400">${val}</span></div>`).join('');
            });
        }

        async function announceWinner() {
            const snap = await get(scoresRef);
            const scores = snap.val() || {};
            const winner = Object.entries(scores).sort((a,b) => b[1]-a[1])[0];
            const winnerName = winner ? winner[0] : "Ø§Ù„Ø¬Ù…ÙŠØ¹";
            
            set(liveRef, { status: 'finished', winner: winnerName });
            document.getElementById('display-title').innerText = "ğŸ† Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ ğŸ†";
            document.getElementById('display-content').innerHTML = `<h1 class="text-5xl font-bold text-yellow-400 winner-anim">${winnerName}</h1>`;
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }

        // --- PLAYER LOGIC ---
        function listenForGame() {
            onValue(liveRef, (snap) => {
                const data = snap.val(); if (!data) return;
                const area = document.getElementById('player-input-area');
                
                if (data.status === 'finished') {
                    if (data.winner === myName) {
                        area.innerHTML = "<h1 class='text-3xl text-yellow-400 font-bold winner-anim'>Ù„Ù‚Ø¯ ÙØ²Øª! ğŸ†</h1>";
                        confetti();
                    } else {
                        area.innerHTML = `<p class='text-slate-400'>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ: ${data.winner}</p>`;
                    }
                    return;
                }

                document.getElementById('player-q-text').innerText = (data.type === 'brain') ? data.content.q : "Ø§Ù†Ø¸Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©!";
                if (data.type === 'brain') {
                    area.innerHTML = data.content.options.map((opt, i) => `<button onclick="submitAnswer(${i}, ${data.content.correct})" class="p-4 btn-teal rounded-xl font-bold">${opt}</button>`).join('');
                } else {
                    area.innerHTML = "<p class='text-teal-400'>Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ø­Ø±ÙƒØ©!</p>";
                }
            });
        }

        window.submitAnswer = (idx, correct) => {
            if (idx === correct) {
                const myScoreRef = ref(db, `scores/${myName}`);
                get(myScoreRef).then(s => set(myScoreRef, (s.val() || 0) + 10));
            }
            document.getElementById('player-input-area').innerHTML = "<p class='text-teal-500'>ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!</p>";
        };
    </script>
</body>
</html>
